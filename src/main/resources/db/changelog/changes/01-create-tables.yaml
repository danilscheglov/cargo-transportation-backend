databaseChangeLog:
  - changeSet:
      id: 1
      author: init
      changes:
        # Driver table
        - createTable:
            tableName: driver
            columns:
              - column:
                  name: driver_id
                  type: serial
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: driver_surname
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: driver_name
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: driver_patronymic
                  type: varchar(50)
                  constraints:
                    nullable: true
              - column:
                  name: driver_phone
                  type: varchar(25)
                  constraints:
                    nullable: false
              - column:
                  name: driver_email
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: driver_password
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: driver_experience
                  type: int4
                  constraints:
                    nullable: false

        # Car table
        - createTable:
            tableName: car
            columns:
              - column:
                  name: car_id
                  type: serial
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: driver_id
                  type: int4
                  constraints:
                    nullable: false
              - column:
                  name: car_number
                  type: varchar(20)
                  constraints:
                    nullable: false
              - column:
                  name: car_model
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: car_brand
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: car_capacity
                  type: decimal(10,2)
                  constraints:
                    nullable: false
              - column:
                  name: car_mileage
                  type: int4
                  constraints:
                    nullable: false
              - column:
                  name: car_condition
                  type: varchar(20)
                  constraints:
                    nullable: false
              - column:
                  name: car_last_maintenance_date
                  type: date
                  constraints:
                    nullable: true

        # Client table
        - createTable:
            tableName: client
            columns:
              - column:
                  name: client_id
                  type: serial
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: client_surname
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: client_name
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: client_patronymic
                  type: varchar(50)
                  constraints:
                    nullable: true
              - column:
                  name: client_phone
                  type: varchar(25)
                  constraints:
                    nullable: false
              - column:
                  name: client_email
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: client_password
                  type: varchar(255)
                  constraints:
                    nullable: false

        # Dispatcher table
        - createTable:
            tableName: dispatcher
            columns:
              - column:
                  name: dispatcher_id
                  type: serial
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: dispatcher_surname
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: dispatcher_name
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: dispatcher_patronymic
                  type: varchar(50)
                  constraints:
                    nullable: true
              - column:
                  name: dispatcher_phone
                  type: varchar(25)
                  constraints:
                    nullable: false
              - column:
                  name: dispatcher_email
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: dispatcher_password
                  type: varchar(255)
                  constraints:
                    nullable: false

        # Mechanic table
        - createTable:
            tableName: mechanic
            columns:
              - column:
                  name: mechanic_id
                  type: serial
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: mechanic_surname
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: mechanic_name
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: mechanic_patronymic
                  type: varchar(50)
                  constraints:
                    nullable: true
              - column:
                  name: mechanic_phone
                  type: varchar(25)
                  constraints:
                    nullable: false
              - column:
                  name: mechanic_email
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: mechanic_password
                  type: varchar(255)
                  constraints:
                    nullable: false

        # Operator table
        - createTable:
            tableName: operator
            columns:
              - column:
                  name: operator_id
                  type: serial
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: operator_surname
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: operator_name
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: operator_patronymic
                  type: varchar(50)
                  constraints:
                    nullable: true
              - column:
                  name: operator_phone
                  type: varchar(25)
                  constraints:
                    nullable: false
              - column:
                  name: operator_email
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: operator_password
                  type: varchar(255)
                  constraints:
                    nullable: false

        # Flight table
        - createTable:
            tableName: flight
            columns:
              - column:
                  name: flight_id
                  type: serial
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: driver_id
                  type: int4
                  constraints:
                    nullable: false
              - column:
                  name: dispatcher_id
                  type: int4
                  constraints:
                    nullable: false
              - column:
                  name: car_id
                  type: int4
                  constraints:
                    nullable: false
              - column:
                  name: flight_startpoint
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: flight_endpoint
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: flight_distance
                  type: decimal(10,2)
                  constraints:
                    nullable: false
              - column:
                  name: flight_departure_date
                  type: date
                  constraints:
                    nullable: false

        # Order table
        - createTable:
            tableName: "order"
            columns:
              - column:
                  name: order_id
                  type: serial
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: client_id
                  type: int4
                  constraints:
                    nullable: false
              - column:
                  name: operator_id
                  type: int4
                  constraints:
                    nullable: false
              - column:
                  name: flight_id
                  type: int4
                  constraints:
                    nullable: true
              - column:
                  name: order_startpoint
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: order_endpoint
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: order_dispatch_date
                  type: date
                  constraints:
                    nullable: false
              - column:
                  name: order_delivery_date
                  type: date
                  constraints:
                    nullable: false
              - column:
                  name: order_status
                  type: varchar(20)
                  constraints:
                    nullable: false

        # Cargo table
        - createTable:
            tableName: cargo
            columns:
              - column:
                  name: cargo_id
                  type: serial
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: order_id
                  type: int4
                  constraints:
                    nullable: false
              - column:
                  name: cargo_type
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: cargo_weight
                  type: decimal(10,2)
                  constraints:
                    nullable: false
              - column:
                  name: cargo_volume
                  type: decimal(10,2)
                  constraints:
                    nullable: false

        # Maintenance Request table
        - createTable:
            tableName: maintenance_request
            columns:
              - column:
                  name: maintenance_request_id
                  type: serial
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: car_id
                  type: int4
                  constraints:
                    nullable: false
              - column:
                  name: mechanic_id
                  type: int4
                  constraints:
                    nullable: false
              - column:
                  name: filling_date
                  type: date
                  constraints:
                    nullable: false
              - column:
                  name: service_type
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: maintenance_request_status
                  type: varchar(20)
                  constraints:
                    nullable: false
              - column:
                  name: maintenance_request_note
                  type: text
                  constraints:
                    nullable: true

  - changeSet:
      id: 2
      author: init
      changes:
        # Foreign Key Constraints
        - addForeignKeyConstraint:
            baseColumnNames: driver_id
            baseTableName: car
            constraintName: fk_car_driver
            referencedColumnNames: driver_id
            referencedTableName: driver

        - addForeignKeyConstraint:
            baseColumnNames: order_id
            baseTableName: cargo
            constraintName: fk_cargo_order
            referencedColumnNames: order_id
            referencedTableName: "order"

        - addForeignKeyConstraint:
            baseColumnNames: driver_id
            baseTableName: flight
            constraintName: fk_flight_driver
            referencedColumnNames: driver_id
            referencedTableName: driver

        - addForeignKeyConstraint:
            baseColumnNames: dispatcher_id
            baseTableName: flight
            constraintName: fk_flight_dispatcher
            referencedColumnNames: dispatcher_id
            referencedTableName: dispatcher

        - addForeignKeyConstraint:
            baseColumnNames: car_id
            baseTableName: flight
            constraintName: fk_flight_car
            referencedColumnNames: car_id
            referencedTableName: car

        - addForeignKeyConstraint:
            baseColumnNames: car_id
            baseTableName: maintenance_request
            constraintName: fk_maintenance_request_car
            referencedColumnNames: car_id
            referencedTableName: car

        - addForeignKeyConstraint:
            baseColumnNames: mechanic_id
            baseTableName: maintenance_request
            constraintName: fk_maintenance_request_mechanic
            referencedColumnNames: mechanic_id
            referencedTableName: mechanic

        - addForeignKeyConstraint:
            baseColumnNames: client_id
            baseTableName: "order"
            constraintName: fk_order_client
            referencedColumnNames: client_id
            referencedTableName: client

        - addForeignKeyConstraint:
            baseColumnNames: operator_id
            baseTableName: "order"
            constraintName: fk_order_operator
            referencedColumnNames: operator_id
            referencedTableName: operator

        - addForeignKeyConstraint:
            baseColumnNames: flight_id
            baseTableName: "order"
            constraintName: fk_order_flight
            referencedColumnNames: flight_id
            referencedTableName: flight
